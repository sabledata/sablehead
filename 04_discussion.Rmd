# Discussion

All cranial dimensions collected in the research investigation were found to be good predictors of sablefish fork length (L~FL~) with resulting r^2^ values for male and female sablefish >0.88.  However, the catch sampling program implemented the interorbital distance (L~ID~) length measurement as the new standard based on feedback from the experienced technicians.  This measurement could be performed quickly, accurately and repeatedly.  In general, they reported measurement errors were more probable when the calipers were placed on soft tissues, rather than bone.  Other errors were a result of the manner in which the sablefish were handled before measurement, ie. the operculum was cut off.  Samplers also reported that the smaller sablefish placed limitations on performing cranial measurements.  Future studies could expand the size range to include small fish to determine those factors that influence predictions of L~FL~.  During this phase of the research investigation, the Pacific Biological Station Molecular Genetics Laboratory successfully developed a genetic protocol to determine sex.

The pilot commercial fishing trip for collection of sablefish heads returned high quality samples and fishers were successful in fish sex determinations (I hope x %).  These pilot samples were measured by three experienced technicians using a standardized protocol that determined  L~UJ~ and L~ID~ had lower average errors over L~SL~ and L~PP~.  This matched the comments on the  difficulty in caliper jaw positioning during the L~SL~ and L~PP~ measurements.  Success with this pilot may be useful for other species such as Pacific halibut who experience predation problems on longline surveys, or difficult to measure deep water species.

As a result of our study, routine biological sampling procedures in 2018 were modified so that commercial fisheries are now only returning head samples, rather than the entire fish. These changes have improved the fishers ability to freeze, store and transport samples.    We recommend that a follow-up review in a couple years to better examine how sampling rates, length composition and spatial distribution have changed to improve our overall data confidence.


```{r figureComposition,  results='asis',  out.width = "410px", out.height = "400px",fig.align='left'}

    #However, our overall goals were also intended to expand spatial distribution of samples and increase the number of samples.  
    #Unfortunately, these goals were not met given sampling challenges caused by COVID restrictions that began in early 2020.  
    #Now that travel restrictions are being lifted we are hopeful that our sampling coverage will expand improving our overall data confidence.  
    
   
    #png("C:/github/sablehead/figures/FigureDiscussion.png", units="px", width=1600, height=1800, res=150) # write png to file

    # did we get bigger fish returned from the fishery after 2018 -- nope because of all the baby sablefish that flooded the fishery
    #   Recruitment is one of the dominant processes regulating fish population productivity
     library(dplyr)
     samples  <- paste(" SELECT TRIP_SUB_TYPE_CODE, TRIP_SUB_TYPE_DESC, [trip year], fishing_year,   ",
                       " dbo.ll_SableFishingYearNo(fishing_year) AS fynum, ",
		                   " SPECIMEN_ID, SAMPLE_ID, SPECIMEN_SEX_CODE, Fork_Length, SPECIMEN_AGE  ",
		                   " FROM  dbo.GENERIC_GFBIO_COMMERCIAL_SPECIMENS_LWSMO  ",
		                   " WHERE (Fork_Length >0)  AND  ([trip year] > 2015)   ",
                       " AND (SPECIMEN_AGE IS NULL) " , sep='')  

    #specimens     <- GetSQLData(samples ,"Sablefish")
    #write.table( specimens, file = paste(path,"CommSpecimensCY.csv",sep=''),row.names=FALSE, na="",col.names=TRUE, sep=",")
    specimens     <-  read.csv(paste(path,"CommSpecimensCY.csv", sep=''), header=T) # read from csv
    # print(head(specimens))
    specimens  <- specimens %>%  mutate(GR = ifelse(fishing_year %in% c('FY 2016/2017','FY 2017/2018'), 1, 2))
    
    specimens.before  <-  specimens[specimens$GR==1,]
    a                 <-  specimens.before[specimens.before$Fork_Length>=550,]
    legal.before      <-  length(a$Fork_Length)/length(specimens.before$Fork_Length)  # 44%  count of big fish/ total fish pre2018 
        
    specimens.after   <-  specimens[specimens$GR==2,]
    b  <- specimens.after[specimens.after$Fork_Length>=550,]
    legal.after<-  length(b$Fork_Length)/length(specimens.after$Fork_Length)   # 13% count of big fish/ total fish post 2108

    #unique(specimens$fishing_year)   # indicates the fishing years
    #print(legal.before)
    #print(legal.after)
    
      gear.samples  <- paste(" SELECT  TRIP_SUB_TYPE_CODE, TRIP_SUB_TYPE_DESC, [trip year], fishing_year, ",
                             " dbo.ll_SableFishingYearNo(fishing_year) AS fynum, SPECIMEN_ID, SAMPLE_ID, ",
                             " SPECIMEN_SEX_CODE, Fork_Length, SPECIMEN_AGE,  GEAR_DESC ",
                             " FROM  dbo.GENERIC_GFBIO_COMMERCIAL_SPECIMENS_LWSMO ",
                             " WHERE  (Fork_Length > 0) AND ([trip year] > 2015)" , sep='')  

    #gear.specimens     <- GetSQLData(gear.samples ,"Sablefish")
    #write.table( gear.specimens, file = paste(path,"GearCommSpecimensCY.csv",sep=''),row.names=FALSE, na="",col.names=TRUE, sep=",")
    gear.specimens     <-  read.csv(paste(path,"GearCommSpecimensCY.csv", sep=''), header=T) # read from csv
    #print(head(gear.specimens))
    
     # sex in(1,2) only  for calendar years, 2020 only has 6 so left out  
     gear.fishery <- gear.specimens[gear.specimens$SPECIMEN_SEX_CODE %in% c(1,2) & gear.specimens$trip.year != 2020,]
                           # previous query: all fishing years Levels: FY 2016/2017 FY 2017/2018 FY 2018/2019 FY 2019/2020
                           # & gear.specimens$fynum %in% c(12,13,14,15),]

     # group data into 5 cm intervals    
     gear.fishery <- gear.fishery %>% mutate(lengthcm = 
			         cut(Fork_Length/10, breaks=seq(0, 100,by=5)))  
     names(gear.fishery)  <- c("TRIP_SUB_TYPE_CODE" ,"TRIP_SUB_TYPE_DESC" ,"trip.year" ,  "fishing_year" , "fynum"  ,
                               "SPECIMEN_ID" ,  "SAMPLE_ID" , "sex" , "Fork_Length" ,  "SPECIMEN_AGE" ,
                               "GEAR_DESC" , "lengthcm"  )
   
   library(plyr)  # mean, standard deviation and count
   df.text<-ddply( gear.fishery,.(trip.year, sex),summarise,
                                   mean.value= round(mean(Fork_Length)/10,1) ,
                                   stdev.value =  round(sd(Fork_Length)/10,1)   , 
                                   count.value = length(SPECIMEN_ID))
 

   p <- ggplot( gear.fishery, aes(x = lengthcm)) +
         #ggtitle("commercial length composition") +
         geom_histogram(aes(color = as.factor(sex),
                 	                     fill = as.factor(sex)), 
                 	                     stat="count",  position = "identity",alpha = 0.3)     +
                                       scale_fill_manual(values = c("#00AFBB", "#E7B800")) +
                                       scale_color_manual(values = c("#00AFBB", "#E7B800")) +
        geom_vline(xintercept = 5.5, col="red",  linetype="dashed")  +
        theme(axis.text.x = element_text(angle = 90)) 

   p2<-p + facet_wrap(~trip.year) + 
        geom_text(data=df.text,aes(label=paste(" n=",count.value), 
                                  color = as.factor(sex), x=-Inf,y=Inf), 
                                  size = 2.5, hjust=-0.1, vjust=c(6,8,6,8,6,8,6,8)) +
        geom_text(data=df.text,aes(label = paste("mean=", mean.value ) , 
                                  color = as.factor(sex), x=-Inf,y=Inf), 
                                  size = 2.5, hjust=-0.9, vjust=c(6,8,6,8,6,8,6,8))   +
        geom_text(data=df.text,aes(label=paste("SD=", stdev.value ), 
                                  color = as.factor(sex), x=-Inf,y=Inf), 
                                  size = 2.5, hjust=-2.9, vjust=c(6,8,6,8,6,8,6,8) )
   
    # while (!is.null(dev.list()))  dev.off()
    # img <-   paste('C:/github/sablehead/figures/figureDiscussion.png',sep="")   # -- retrieve png 
    #          knitr::include_graphics(img)
    

```

# Acknowledgments

We thank Schon Acheson and Kristina Castle for lending their skilled technical expertise for this report.  We also thank the Molecular Genetics Laboratory at PBS for developing a sablefish gender test. A special thanks to the crew of the Pacific Viking for participating in the pilot project.

\clearpage