img <-   paste('C:/github/sablehead/figures/Figure1.png',sep="")   # -- retrieve png
knitr::include_graphics(img)
map
tail(points_df)
map          <-  ggplot() +
geom_polygon(data = shapef_can,
aes(x = long, y = lat, group = group),
fill="gray40",
size = .2) +
geom_polygon(data = seam_can, aes(x = long, y =  lat, group = group), color = "gray40", alpha = 0, linetype = 1)  +
geom_point(data =   points_df,   aes(pointdata.SLON, pointdata.SLAT,
fill=factor(pointdata.TRIP_ID),  size=0.7) ,
colour="gray50", shape=21, size=5) +
geom_text(aes(x =  -130.9281, y = 46.7093, label = "Cobb"),
alpha = 1,
color = "grey40")  +
geom_text(aes(x =  -133.2040, y = 48.2828, label = "Eickelberg"),
alpha = 1,
color = "grey40")  +
theme_minimal()    +
guides(fill="none") +
guides(size="none") +
guides(fill=guide_legend(title="Trip")) +
xlab("Longitude") + ylab("Latitude") +
theme(  text = element_text(size=20),
plot.title      = element_blank(),
legend.position = c(.29, 0.45),
legend.justification = c("right", "top"),
legend.box.just = "right",
legend.margin = margin(6, 6, 6, 6)
)
map
map          <-  ggplot() +
geom_polygon(data = shapef_can,
aes(x = long, y = lat, group = group),
fill="gray40",
size = .2) +
geom_polygon(data = seam_can, aes(x = long, y =  lat, group = group), color = "gray40", alpha = 0, linetype = 1)  +
geom_point(data =   points_df,   aes(pointdata.SLON, pointdata.SLAT,
fill=factor(pointdata.TRIP_ID),  size=0.7) ,
colour="gray50", shape=21, size=5) +
geom_text(aes(x =  -130.5281, y = 46.7093, label = "Cobb"),
alpha = 1,
color = "grey40")  +
geom_text(aes(x =  -133.0040, y = 48.2828, label = "Eickelberg"),
alpha = 1,
color = "grey40")  +
theme_minimal()    +
guides(fill="none") +
guides(size="none") +
guides(fill=guide_legend(title="Trip")) +
xlab("Longitude") + ylab("Latitude") +
theme(  text = element_text(size=20),
plot.title      = element_blank(),
legend.position = c(.29, 0.45),
legend.justification = c("right", "top"),
legend.box.just = "right",
legend.margin = margin(6, 6, 6, 6)
)
map
map          <-  ggplot() +
geom_polygon(data = shapef_can,
aes(x = long, y = lat, group = group),
fill="gray40",
size = .2) +
geom_polygon(data = seam_can, aes(x = long, y =  lat, group = group), color = "gray40", alpha = 0, linetype = 1)  +
geom_point(data =   points_df,   aes(pointdata.SLON, pointdata.SLAT,
fill=factor(pointdata.TRIP_ID),  size=0.7) ,
colour="gray50", shape=21, size=5) +
geom_text(aes(x =  -130.2281, y = 46.7093, label = "Cobb"),
alpha = 1,
color = "grey40")  +
geom_text(aes(x =  -132.6040, y = 48.2828, label = "Eickelberg"),
alpha = 1,
color = "grey40")  +
theme_minimal()    +
guides(fill="none") +
guides(size="none") +
guides(fill=guide_legend(title="Trip")) +
xlab("Longitude") + ylab("Latitude") +
theme(  text = element_text(size=20),
plot.title      = element_blank(),
legend.position = c(.29, 0.45),
legend.justification = c("right", "top"),
legend.box.just = "right",
legend.margin = margin(6, 6, 6, 6)
)
map
map          <-  ggplot() +
geom_polygon(data = shapef_can,
aes(x = long, y = lat, group = group),
fill="gray40",
size = .2) +
geom_polygon(data = seam_can, aes(x = long, y =  lat, group = group), color = "gray40", alpha = 0, linetype = 1)  +
geom_point(data =   points_df,   aes(pointdata.SLON, pointdata.SLAT,
fill=factor(pointdata.TRIP_ID),  size=0.7) ,
colour="gray50", shape=21, size=5) +
geom_text(aes(x =  -130.0281, y = 46.7093, label = "Cobb"),
alpha = 1,
color = "grey40")  +
geom_text(aes(x =  -131.6040, y = 48.2828, label = "Eickelberg"),
alpha = 1,
color = "grey40")  +
theme_minimal()    +
guides(fill="none") +
guides(size="none") +
guides(fill=guide_legend(title="Trip")) +
xlab("Longitude") + ylab("Latitude") +
theme(  text = element_text(size=20),
plot.title      = element_blank(),
legend.position = c(.29, 0.45),
legend.justification = c("right", "top"),
legend.box.just = "right",
legend.margin = margin(6, 6, 6, 6)
)
map
map          <-  ggplot() +
geom_polygon(data = shapef_can,
aes(x = long, y = lat, group = group),
fill="gray40",
size = .2) +
geom_polygon(data = seam_can, aes(x = long, y =  lat, group = group), color = "gray40", alpha = 0, linetype = 1)  +
geom_point(data =   points_df,   aes(pointdata.SLON, pointdata.SLAT,
fill=factor(pointdata.TRIP_ID),  size=0.7) ,
colour="gray50", shape=21, size=5) +
geom_text(aes(x =  -130.000, y = 46.7093, label = "Cobb"),
alpha = 1,
color = "grey40")  +
geom_text(aes(x =  -131.6040, y = 48.2828, label = "Eickelberg"),
alpha = 1,
color = "grey40")  +
theme_minimal()    +
guides(fill="none") +
guides(size="none") +
guides(fill=guide_legend(title="Trip")) +
xlab("Longitude") + ylab("Latitude") +
theme(  text = element_text(size=20),
plot.title      = element_blank(),
legend.position = c(.29, 0.45),
legend.justification = c("right", "top"),
legend.box.just = "right",
legend.margin = margin(6, 6, 6, 6)
)
map
map          <-  ggplot() +
geom_polygon(data = shapef_can,
aes(x = long, y = lat, group = group),
fill="gray40",
size = .2) +
geom_polygon(data = seam_can, aes(x = long, y =  lat, group = group), color = "gray40", alpha = 0, linetype = 1)  +
geom_point(data =   points_df,   aes(pointdata.SLON, pointdata.SLAT,
fill=factor(pointdata.TRIP_ID),  size=0.7) ,
colour="gray10", shape=21, size=5) +
geom_text(aes(x =  -130.000, y = 46.7093, label = "Cobb"),
alpha = 1,
color = "grey40")  +
geom_text(aes(x =  -131.6040, y = 48.2828, label = "Eickelberg"),
alpha = 1,
color = "grey40")  +
theme_minimal()    +
guides(fill="none") +
guides(size="none") +
guides(fill=guide_legend(title="Trip")) +
xlab("Longitude") + ylab("Latitude") +
theme(  text = element_text(size=20),
plot.title      = element_blank(),
legend.position = c(.29, 0.45),
legend.justification = c("right", "top"),
legend.box.just = "right",
legend.margin = margin(6, 6, 6, 6)
)
map
map          <-  ggplot() +
geom_polygon(data = shapef_can,
aes(x = long, y = lat, group = group),
fill="gray40",
size = .2) +
geom_polygon(data = seam_can, aes(x = long, y =  lat, group = group), color = "gray40", alpha = 0, linetype = 1)  +
geom_point(data =   points_df,   aes(pointdata.SLON, pointdata.SLAT,
fill=factor(pointdata.TRIP_ID),  size=0.7) ,
colour="lightgray", shape=21, size=5) +
geom_text(aes(x =  -130.000, y = 46.7093, label = "Cobb"),
alpha = 1,
color = "grey40")  +
geom_text(aes(x =  -131.6040, y = 48.2828, label = "Eickelberg"),
alpha = 1,
color = "grey40")  +
theme_minimal()    +
guides(fill="none") +
guides(size="none") +
guides(fill=guide_legend(title="Trip")) +
xlab("Longitude") + ylab("Latitude") +
theme(  text = element_text(size=20),
plot.title      = element_blank(),
legend.position = c(.29, 0.45),
legend.justification = c("right", "top"),
legend.box.just = "right",
legend.margin = margin(6, 6, 6, 6)
)
map
map          <-  ggplot() +
geom_polygon(data = shapef_can,
aes(x = long, y = lat, group = group),
fill="gray40",
size = .2) +
geom_polygon(data = seam_can, aes(x = long, y =  lat, group = group), color = "lightgray", alpha = 0, linetype = 1)  +
geom_point(data =   points_df,   aes(pointdata.SLON, pointdata.SLAT,
fill=factor(pointdata.TRIP_ID),  size=0.7) ,
colour="lightgray", shape=21, size=5) +
geom_text(aes(x =  -130.000, y = 46.7093, label = "Cobb"),
alpha = 1,
color = "grey40")  +
geom_text(aes(x =  -131.6040, y = 48.2828, label = "Eickelberg"),
alpha = 1,
color = "grey40")  +
theme_minimal()    +
guides(fill="none") +
guides(size="none") +
guides(fill=guide_legend(title="Trip")) +
xlab("Longitude") + ylab("Latitude") +
theme(  text = element_text(size=20),
plot.title      = element_blank(),
legend.position = c(.29, 0.45),
legend.justification = c("right", "top"),
legend.box.just = "right",
legend.margin = margin(6, 6, 6, 6)
)
map
#  author:  L. Lacko
#  date: 6/8/2022
#  source("C:/DATA/PROJECTS/Sablefish/Review_FOS/Review_FOS.R")
if(!(require(RODBC))) install.packages("RODBC")
# path<-"//DFBCV9TWVASP001/Shares$/Holt/OM_data/"
path<-"C:/DATA/PROJECTS/Sablefish/Review_FOS/"
# ------------SQL SERVER LOAD-------------------------
GetSQLData <- function(strSQL,strDbName) {
require(RODBC)
cnn <- odbcDriverConnect(paste("Driver={SQL Server};Server=DFBCV9TWVASP001;",
"Database=",strDbName,";Trusted_Connection=Yes",sep=""))
dat <- sqlQuery(cnn, strSQL)
odbcClose(cnn)
return(dat)
}
#  query--------------------------------------
<- paste("SELECT YEAR, BEST_YEAR, TRIP_ID, FISHING_EVENT_ID, Set_number, ",
"FISHERY_SECTOR, DATA_SOURCE_NAME, SEAMOUNT_IND, EXPERIMENTAL_IND, ",
"GEAR, GEAR_SUBTYPE, R_TOTAL_RELEASED_KG ",
"from dbo.gfsh_sablefish_official_catch_report
"where (YEAR = 2018)"
release.dat<- GetSQLData(releases,"Sablefish")
write.table(release.dat, file = paste(path,"View_releases.csv",sep=''), row.names=FALSE, na="", col.names=TRUE, sep=",")
#  date: 6/8/2022
#  source("C:/DATA/PROJECTS/Sablefish/Review_FOS/Review_FOS.R")
if(!(require(RODBC))) install.packages("RODBC")
# path<-"//DFBCV9TWVASP001/Shares$/Holt/OM_data/"
path<-"C:/DATA/PROJECTS/Sablefish/Review_FOS/"
# ------------SQL SERVER LOAD-------------------------
GetSQLData <- function(strSQL,strDbName) {
require(RODBC)
cnn <- odbcDriverConnect(paste("Driver={SQL Server};Server=DFBCV9TWVASP001;",
"Database=",strDbName,";Trusted_Connection=Yes",sep=""))
dat <- sqlQuery(cnn, strSQL)
odbcClose(cnn)
return(dat)
}
#  query--------------------------------------
releases  <- paste("SELECT YEAR, BEST_YEAR, TRIP_ID, FISHING_EVENT_ID, Set_number, ",
"FISHERY_SECTOR, DATA_SOURCE_NAME, SEAMOUNT_IND, EXPERIMENTAL_IND, ",
"GEAR, GEAR_SUBTYPE, R_TOTAL_RELEASED_KG ",
"from dbo.gfsh_sablefish_official_catch_report
"where (YEAR = 2018)"
release.dat<- GetSQLData(releases,"Sablefish")
write.table(release.dat, file = paste(path,"View_releases.csv",sep=''), row.names=FALSE, na="", col.names=TRUE, sep=",")
#  author:  L. Lacko
#  date: 6/8/2022
#  source("C:/DATA/PROJECTS/Sablefish/Review_FOS/Review_FOS.R")
if(!(require(RODBC))) install.packages("RODBC")
# path<-"//DFBCV9TWVASP001/Shares$/Holt/OM_data/"
path<-"C:/DATA/PROJECTS/Sablefish/Review_FOS/"
# ------------SQL SERVER LOAD-------------------------
GetSQLData <- function(strSQL,strDbName) {
require(RODBC)
cnn <- odbcDriverConnect(paste("Driver={SQL Server};Server=DFBCV9TWVASP001;",
"Database=",strDbName,";Trusted_Connection=Yes",sep=""))
dat <- sqlQuery(cnn, strSQL)
odbcClose(cnn)
return(dat)
}
#  query--------------------------------------
releases  <- paste("SELECT YEAR, BEST_YEAR, TRIP_ID, FISHING_EVENT_ID, Set_number, ",
"FISHERY_SECTOR, DATA_SOURCE_NAME, SEAMOUNT_IND, EXPERIMENTAL_IND, ",
"GEAR, GEAR_SUBTYPE, R_TOTAL_RELEASED_KG ",
"from dbo.gfsh_sablefish_official_catch_report ",
"where (YEAR = 2018)"
release.dat<- GetSQLData(releases,"Sablefish")
write.table(release.dat, file = paste(path,"View_releases.csv",sep=''), row.names=FALSE, na="", col.names=TRUE, sep=",")
#  query--------------------------------------
releases  <- paste("SELECT YEAR, BEST_YEAR, TRIP_ID, FISHING_EVENT_ID, Set_number, ",
"FISHERY_SECTOR, DATA_SOURCE_NAME, SEAMOUNT_IND, EXPERIMENTAL_IND, ",
"GEAR, GEAR_SUBTYPE, R_TOTAL_RELEASED_KG ",
"from dbo.gfsh_sablefish_official_catch_report ",
"where (YEAR = 2018)", sep='')
release.dat<- GetSQLData(releases,"Sablefish")
write.table(release.dat, file = paste(path,"View_releases.csv",sep=''), row.names=FALSE, na="", col.names=TRUE, sep=",")
ggplot(release.dat, aes(x=FISHING_EVENT_ID, y=R_TOTAL_RELEASED_KG)) + geom_point()
release.dat <- release.dat[release.dat$FISHING_EVENT_ID>0,]
ggplot(release.dat, aes(x=FISHING_EVENT_ID, y=R_TOTAL_RELEASED_KG)) + geom_point()
releases  <- paste("SELECT YEAR, BEST_YEAR, TRIP_ID, FISHING_EVENT_ID, Set_number, ",
"FISHERY_SECTOR, DATA_SOURCE_NAME, SEAMOUNT_IND, EXPERIMENTAL_IND, ",
"GEAR, GEAR_SUBTYPE, R_TOTAL_RELEASED_KG ",
"from dbo.gfsh_sablefish_official_catch_report ",
"where (YEAR > 2018)", sep='')
release.dat<- GetSQLData(releases,"Sablefish")
write.table(release.dat, file = paste(path,"View_releases.csv",sep=''), row.names=FALSE, na="", col.names=TRUE, sep=",")
release.dat <- release.dat[release.dat$FISHING_EVENT_ID>0,]
ggplot(release.dat, aes(x=FISHING_EVENT_ID, y=R_TOTAL_RELEASED_KG)) +
geom_point()  +
facet_grid(rows = vars(BEST_YEAR))
ggplot(release.dat, aes(x=R_TOTAL_RELEASED_KG, y=FISHING_EVENT_ID)) +
geom_point()  +
facet_grid(rows = vars(BEST_YEAR))
#  query--------------------------------------
releases  <- paste("SELECT YEAR, BEST_YEAR, TRIP_ID, FISHING_EVENT_ID, Set_number, ",
"FISHERY_SECTOR, DATA_SOURCE_NAME, SEAMOUNT_IND, EXPERIMENTAL_IND,  ",
"GEAR, GEAR_SUBTYPE, SUM(R_TOTAL_RELEASED_KG) AS releases,  ",
"dbo.DayOfYear(BEST_DATE) AS day ",
"FROM  dbo.gfsh_sablefish_official_catch_report  ",
"GROUP BY YEAR, BEST_YEAR, TRIP_ID, FISHING_EVENT_ID, Set_number, FISHERY_SECTOR,  ",
"DATA_SOURCE_NAME, SEAMOUNT_IND, EXPERIMENTAL_IND, GEAR,  ",
"GEAR_SUBTYPE, dbo.DayOfYear(BEST_DATE) ",
"HAVING  (YEAR >= 2018)", sep='')
release.dat<- GetSQLData(releases,"Sablefish")
write.table(release.dat, file = paste(path,"View_releases.csv",sep=''), row.names=FALSE, na="", col.names=TRUE, sep=",")
release.dat <- release.dat[release.dat$FISHING_EVENT_ID>0,]
ggplot(release.dat, aes(x=R_TOTAL_RELEASED_KG, y=day)) +
geom_point()  +
facet_grid(rows = vars(BEST_YEAR))
ggplot(release.dat, aes(x=releases, y=day)) +
geom_point()  +
facet_grid(rows = vars(BEST_YEAR))
ggplot(release.dat, aes(x=day, y=releases)) +
geom_point()  +
facet_grid(rows = vars(BEST_YEAR))
releases  <- paste("SELECT YEAR, BEST_YEAR, TRIP_ID, FISHING_EVENT_ID, Set_number, ",
"FISHERY_SECTOR, DATA_SOURCE_NAME, SEAMOUNT_IND, EXPERIMENTAL_IND,  ",
"GEAR, GEAR_SUBTYPE, SUM(R_TOTAL_RELEASED_KG) AS releases,  ",
"dbo.DayOfYear(BEST_DATE) AS day ",
"FROM  dbo.gfsh_sablefish_official_catch_report  ",
"GROUP BY YEAR, BEST_YEAR, TRIP_ID, FISHING_EVENT_ID, Set_number, FISHERY_SECTOR,  ",
"DATA_SOURCE_NAME, SEAMOUNT_IND, EXPERIMENTAL_IND, GEAR,  ",
"GEAR_SUBTYPE, dbo.DayOfYear(BEST_DATE) ",
"HAVING  (YEAR >= 2018)", sep='')
release.dat<- GetSQLData(releases,"Sablefish")
write.table(release.dat, file = paste(path,"View_releases.csv",sep=''), row.names=FALSE, na="", col.names=TRUE, sep=",")
release.dat <- release.dat[release.dat$FISHING_EVENT_ID>0,]
ggplot(release.dat, aes(x=day, y=releases)) +
geom_point()  +
facet_grid(rows = vars(BEST_YEAR + GEAR))
releases  <- paste("SELECT YEAR, BEST_YEAR, TRIP_ID, FISHING_EVENT_ID, Set_number, ",
"FISHERY_SECTOR, DATA_SOURCE_NAME, SEAMOUNT_IND, EXPERIMENTAL_IND,  ",
"GEAR, GEAR_SUBTYPE, SUM(R_TOTAL_RELEASED_KG) AS releases,  ",
"dbo.DayOfYear(BEST_DATE) AS day ",
"FROM  dbo.gfsh_sablefish_official_catch_report  ",
"GROUP BY YEAR, BEST_YEAR, TRIP_ID, FISHING_EVENT_ID, Set_number, FISHERY_SECTOR,  ",
"DATA_SOURCE_NAME, SEAMOUNT_IND, EXPERIMENTAL_IND, GEAR,  ",
"GEAR_SUBTYPE, dbo.DayOfYear(BEST_DATE) ",
"HAVING  (YEAR >= 2018)", sep='')
release.dat<- GetSQLData(releases,"Sablefish")
write.table(release.dat, file = paste(path,"View_releases.csv",sep=''), row.names=FALSE, na="", col.names=TRUE, sep=",")
release.dat <- release.dat[release.dat$FISHING_EVENT_ID>0,]
ggplot(release.dat, aes(x=day, y=releases)) +
geom_point()  +
facet_grid(rows = vars(BEST_YEAR ~ GEAR))
ggplot(release.dat, aes(x=day, y=releases)) +
geom_point()  +
facet_grid(rows = vars(BEST_YEAR + as.factor(GEAR)))
releases  <- paste("SELECT YEAR, BEST_YEAR, TRIP_ID, FISHING_EVENT_ID, Set_number, ",
"FISHERY_SECTOR, DATA_SOURCE_NAME, SEAMOUNT_IND, EXPERIMENTAL_IND,  ",
"CASE WHEN GEAR = 'TRAWL' THEN GEAR_SUBTYPE ELSE GEAR END AS gear, ",
"GEAR_SUBTYPE, SUM(R_TOTAL_RELEASED_KG) AS releases,  ",
"dbo.DayOfYear(BEST_DATE) AS day ",
"FROM  dbo.gfsh_sablefish_official_catch_report  ",
"GROUP BY YEAR, BEST_YEAR, TRIP_ID, FISHING_EVENT_ID, Set_number, FISHERY_SECTOR,  ",
"CASE WHEN GEAR = 'TRAWL' THEN GEAR_SUBTYPE ELSE GEAR END,"
"DATA_SOURCE_NAME, SEAMOUNT_IND, EXPERIMENTAL_IND, ",
"GEAR_SUBTYPE, dbo.DayOfYear(BEST_DATE) ",
"HAVING  (YEAR >= 2018)", sep='')
release.dat<- GetSQLData(releases,"Sablefish")
write.table(release.dat, file = paste(path,"View_releases.csv",sep=''), row.names=FALSE, na="", col.names=TRUE, sep=",")
release.dat <- release.dat[release.dat$FISHING_EVENT_ID>0,]
ggplot(release.dat, aes(x=day, y=releases)) +
geom_point()  +
facet_grid(rows = vars(BEST_YEAR + as.factor(GEAR)))
releases  <- paste("SELECT YEAR, BEST_YEAR, TRIP_ID, FISHING_EVENT_ID, Set_number, ",
"FISHERY_SECTOR, DATA_SOURCE_NAME, SEAMOUNT_IND, EXPERIMENTAL_IND,  ",
"CASE WHEN GEAR = 'TRAWL' THEN GEAR_SUBTYPE ELSE GEAR END AS gear, ",
"GEAR_SUBTYPE, SUM(R_TOTAL_RELEASED_KG) AS releases,  ",
"dbo.DayOfYear(BEST_DATE) AS day ",
"FROM  dbo.gfsh_sablefish_official_catch_report  ",
"GROUP BY YEAR, BEST_YEAR, TRIP_ID, FISHING_EVENT_ID, Set_number, FISHERY_SECTOR,  ",
"CASE WHEN GEAR = 'TRAWL' THEN GEAR_SUBTYPE ELSE GEAR END,"
"DATA_SOURCE_NAME, SEAMOUNT_IND, EXPERIMENTAL_IND, ",
"GEAR_SUBTYPE, dbo.DayOfYear(BEST_DATE) ",
"HAVING  (YEAR >= 2018)", sep='')
releases
releases  <- paste("SELECT YEAR, BEST_YEAR, TRIP_ID, FISHING_EVENT_ID, Set_number, ",
"FISHERY_SECTOR, DATA_SOURCE_NAME, SEAMOUNT_IND, EXPERIMENTAL_IND,  ",
"CASE WHEN GEAR = 'TRAWL' THEN GEAR_SUBTYPE ELSE GEAR END AS gear, ",
"GEAR_SUBTYPE, SUM(R_TOTAL_RELEASED_KG) AS releases,  ",
"dbo.DayOfYear(BEST_DATE) AS day ",
"FROM  dbo.gfsh_sablefish_official_catch_report  ",
"GROUP BY YEAR, BEST_YEAR, TRIP_ID, FISHING_EVENT_ID, Set_number, FISHERY_SECTOR,  ",
"CASE WHEN GEAR = 'TRAWL' THEN GEAR_SUBTYPE ELSE GEAR END, ",
"DATA_SOURCE_NAME, SEAMOUNT_IND, EXPERIMENTAL_IND, ",
"GEAR_SUBTYPE, dbo.DayOfYear(BEST_DATE) ",
"HAVING  (YEAR >= 2018)", sep='')
release.dat<- GetSQLData(releases,"Sablefish")
write.table(release.dat, file = paste(path,"View_releases.csv",sep=''), row.names=FALSE, na="", col.names=TRUE, sep=",")
ggplot(release.dat, aes(x=day, y=releases)) +
geom_point()  +
facet_grid(GEAR ~ ., scales = "free", space = "free")
ggplot(release.dat, aes(x=day, y=releases)) +
geom_point()  +
facet_grid(gear ~ ., scales = "free", space = "free")
ggplot(release.dat, aes(x=day, y=releases)) +
geom_point()  +
facet_grid(gear ~ ., scales = "free", space = "free")
path<-"C:/DATA/PROJECTS/Sablefish/Review_FOS/"
# ------------SQL SERVER LOAD-------------------------
GetSQLData <- function(strSQL,strDbName) {
require(RODBC)
cnn <- odbcDriverConnect(paste("Driver={SQL Server};Server=DFBCV9TWVASP001;",
"Database=",strDbName,";Trusted_Connection=Yes",sep=""))
dat <- sqlQuery(cnn, strSQL)
odbcClose(cnn)
return(dat)
}
#  query--------------------------------------
releases  <- paste("SELECT YEAR, BEST_YEAR, TRIP_ID, FISHING_EVENT_ID, Set_number, ",
"FISHERY_SECTOR, DATA_SOURCE_NAME, SEAMOUNT_IND, EXPERIMENTAL_IND,  ",
"CASE WHEN GEAR = 'TRAWL' THEN GEAR_SUBTYPE ELSE GEAR END AS gear, ",
"GEAR_SUBTYPE, SUM(R_TOTAL_RELEASED_KG) AS releases,  ",
"dbo.DayOfYear(BEST_DATE) AS day ",
"FROM  dbo.gfsh_sablefish_official_catch_report  ",
"GROUP BY YEAR, BEST_YEAR, TRIP_ID, FISHING_EVENT_ID, Set_number, FISHERY_SECTOR,  ",
"CASE WHEN GEAR = 'TRAWL' THEN GEAR_SUBTYPE ELSE GEAR END, ",
"DATA_SOURCE_NAME, SEAMOUNT_IND, EXPERIMENTAL_IND, ",
"GEAR_SUBTYPE, dbo.DayOfYear(BEST_DATE) ",
"HAVING  (YEAR >= 2018)", sep='')
release.dat<- GetSQLData(releases,"Sablefish")
write.table(release.dat, file = paste(path,"View_releases.csv",sep=''), row.names=FALSE, na="", col.names=TRUE, sep=",")
release.dat <- release.dat[release.dat$FISHING_EVENT_ID>0,]
ggplot(release.dat, aes(x=day, y=releases)) +
geom_point()  +
facet_grid(gear ~ ., scales = "free", space = "free")
ggplot(release.dat, aes(x=day, y=releases)) +
geom_point()  +
facet_grid(gear + BEST_YEAR, scales = "free", space = "free")
names(release.dat)
p  <-  ggplot(release.dat, aes(x=day, y=releases)) +   geom_point()
p + facet_grid(gear ~ BEST_YEAR)
#  query--------------------------------------
releases  <- paste("SELECT YEAR, BEST_YEAR, TRIP_ID, FISHING_EVENT_ID, Set_number, ",
"FISHERY_SECTOR, DATA_SOURCE_NAME, SEAMOUNT_IND, EXPERIMENTAL_IND,  ",
"CASE WHEN GEAR = 'TRAWL' THEN GEAR_SUBTYPE ELSE GEAR END AS gear, ",
"GEAR_SUBTYPE, SUM(R_TOTAL_RELEASED_KG) AS releases,  ",
"dbo.DayOfYear(BEST_DATE) AS day ",
"FROM  dbo.gfsh_sablefish_official_catch_report  ",
"GROUP BY YEAR, BEST_YEAR, TRIP_ID, FISHING_EVENT_ID, Set_number, FISHERY_SECTOR,  ",
"CASE WHEN GEAR = 'TRAWL' THEN GEAR_SUBTYPE ELSE GEAR END, ",
"DATA_SOURCE_NAME, SEAMOUNT_IND, EXPERIMENTAL_IND, ",
"GEAR_SUBTYPE, dbo.DayOfYear(BEST_DATE) ",
"HAVING  (YEAR >= 2018)", sep='')
release.dat<- GetSQLData(releases,"Sablefish")
write.table(release.dat, file = paste(path,"View_releases.csv",sep=''), row.names=FALSE, na="", col.names=TRUE, sep=",")
release.dat <- release.dat[release.dat$FISHING_EVENT_ID>0,]
p  <-  ggplot(release.dat, aes(x=day, y=releases)) +   geom_point()
p + facet_grid(gear ~ BEST_YEAR)
#  query--------------------------------------
releases  <- paste("SELECT YEAR, BEST_YEAR, TRIP_ID, FISHING_EVENT_ID, Set_number, ",
"FISHERY_SECTOR, DATA_SOURCE_NAME, SEAMOUNT_IND, EXPERIMENTAL_IND,  ",
"CASE WHEN GEAR = 'TRAWL' THEN GEAR_SUBTYPE ELSE GEAR END AS gear, ",
"GEAR_SUBTYPE, SUM(R_TOTAL_RELEASED_KG) AS releases,  ",
"dbo.DayOfYear(BEST_DATE) AS day ",
"FROM  dbo.gfsh_sablefish_official_catch_report  ",
"GROUP BY YEAR, BEST_YEAR, TRIP_ID, FISHING_EVENT_ID, Set_number, FISHERY_SECTOR,  ",
"CASE WHEN GEAR = 'TRAWL' THEN GEAR_SUBTYPE ELSE GEAR END, ",
"DATA_SOURCE_NAME, SEAMOUNT_IND, EXPERIMENTAL_IND, ",
"GEAR_SUBTYPE, dbo.DayOfYear(BEST_DATE) ",
"HAVING  (YEAR >= 2018)", sep='')
release.dat<- GetSQLData(releases,"Sablefish")
write.table(release.dat, file = paste(path,"View_releases.csv",sep=''), row.names=FALSE, na="", col.names=TRUE, sep=",")
release.dat <- release.dat[release.dat$FISHING_EVENT_ID>0,]
p  <-  ggplot(release.dat, aes(x=day, y=releases)) +   geom_point()
p + facet_grid(gear ~ BEST_YEAR)
releases  <- paste("SELECT YEAR, BEST_YEAR, TRIP_ID, FISHING_EVENT_ID, Set_number, ",
"FISHERY_SECTOR, DATA_SOURCE_NAME, SEAMOUNT_IND, EXPERIMENTAL_IND,  ",
"CASE WHEN GEAR = 'TRAWL' THEN GEAR_SUBTYPE ELSE GEAR END AS gear, ",
"GEAR_SUBTYPE, SUM(R_TOTAL_RELEASED_KG) AS releases,  ",
"dbo.DayOfYear(BEST_DATE) AS day ",
"FROM  dbo.gfsh_sablefish_official_catch_report  ",
"GROUP BY YEAR, BEST_YEAR, TRIP_ID, FISHING_EVENT_ID, Set_number, FISHERY_SECTOR,  ",
"CASE WHEN GEAR = 'TRAWL' THEN GEAR_SUBTYPE ELSE GEAR END, ",
"DATA_SOURCE_NAME, SEAMOUNT_IND, EXPERIMENTAL_IND, ",
"GEAR_SUBTYPE, dbo.DayOfYear(BEST_DATE) ",
"HAVING  (YEAR >= 2018)", sep='')
release.dat<- GetSQLData(releases,"Sablefish")
write.table(release.dat, file = paste(path,"View_releases.csv",sep=''), row.names=FALSE, na="", col.names=TRUE, sep=",")
release.dat <- release.dat[release.dat$FISHING_EVENT_ID>0,]
p  <-  ggplot(release.dat, aes(x=day, y=releases)) +   geom_point()
p + facet_grid(gear ~ BEST_YEAR)
p
